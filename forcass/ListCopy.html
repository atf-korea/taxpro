<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>파일목록 복사</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://aistudiocdn.com/react@^19.2.0",
          "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client"
        }
      }
    </script>
  </head>
  <body class="bg-slate-900 text-slate-100">
    <div id="root"></div>
    <script type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import ReactDOM from 'react-dom/client';

      // --- Icon Components ---
      const UploadIcon = ({ className = "w-6 h-6" }) => (
        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: "1.5", stroke: "currentColor", className: className },
          React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M3 17.25V21h18v-3.75M4.5 12h15" })
        )
      );

      const CodeBracketIcon = ({ className = "w-6 h-6" }) => (
        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: "1.5", stroke: "currentColor", className: className },
          React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" })
        )
      );

      const CheckCircleIcon = ({ className = "w-6 h-6" }) => (
        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: "1.5", stroke: "currentColor", className: className },
          React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" })
        )
      );

      const XCircleIcon = ({ className = "w-6 h-6" }) => (
        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: "1.5", stroke: "currentColor", className: className },
          React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" })
        )
      );

      const ClipboardIcon = ({ className = "w-6 h-6" }) => (
        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: "1.5", stroke: "currentColor", className: className },
          React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v2.25c0 .966-.784 1.75-1.75 1.75H8.25c-.966 0-1.75-.784-1.75-1.75V4.5c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" })
        )
      );

      const ArrowDownTrayIcon = ({ className = "w-6 h-6" }) => (
        React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: "1.5", stroke: "currentColor", className: className },
          React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" })
        )
      );


      // --- Main App Component ---
      const App = () => {
        const [file, setFile] = useState(null);
        const [filePaths, setFilePaths] = useState([]);
        const [destinationFolderName, setDestinationFolderName] = useState('');
        const [userName, setUserName] = useState('');
        const [destinationPrefix, setDestinationPrefix] = useState('');
        const [status, setStatus] = useState('idle');
        const [error, setError] = useState(null);
        const [generatedScript, setGeneratedScript] = useState('');
        const [isDragging, setIsDragging] = useState(false);
        const [isExpired, setIsExpired] = useState(false);

        useEffect(() => {
          const expirationDate = new Date('2025-12-31T23:59:59');
          const currentDate = new Date();
          if (currentDate > expirationDate) {
            setIsExpired(true);
          }
        }, []);
        
        const handleReset = () => {
          setFile(null);
          setFilePaths([]);
          setDestinationFolderName('');
          setUserName('');
          setDestinationPrefix('');
          setStatus('idle');
          setError(null);
          setGeneratedScript('');
        };

        const processFile = (selectedFile) => {
          if (!selectedFile) return;

          if (selectedFile.type !== 'text/plain') {
            setError('유효한 .txt 파일을 업로드해주세요.');
            setStatus('error');
            setFile(null);
            setFilePaths([]);
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            const content = e.target?.result;
            if (typeof content !== 'string') {
                setError('파일 내용을 읽을 수 없습니다. 파일이 손상되었거나 텍스트 형식이 아닐 수 있습니다.');
                setStatus('error');
                setFile(null);
                setFilePaths([]);
                return;
            }

            const paths = content.split('\n').map(p => p.trim()).filter(p => p.length > 0);
            
            if (paths.length === 0) {
                setError('선택한 파일이 비어 있거나 유효한 경로가 없습니다.');
                setStatus('error');
                setFile(null);
                setFilePaths([]);
            } else {
                setFile(selectedFile);
                setFilePaths(paths);
                setError(null);
                setStatus('idle');
            }
          };
          reader.onerror = () => {
            setError('파일을 읽는 데 실패했습니다.');
            setStatus('error');
            setFile(null);
            setFilePaths([]);
          };
          reader.readAsText(selectedFile);
        };
        
        const handleFileChange = (event) => {
          const selectedFile = event.target.files?.[0];
          processFile(selectedFile);
        };

        const handleDragEnter = (e) => {
          e.preventDefault();
          e.stopPropagation();
          setIsDragging(true);
        };

        const handleDragLeave = (e) => {
          e.preventDefault();
          e.stopPropagation();
          setIsDragging(false);
        };

        const handleDragOver = (e) => {
          e.preventDefault();
          e.stopPropagation();
        };

        const handleDrop = (e) => {
          e.preventDefault();
          e.stopPropagation();
          setIsDragging(false);
          const files = e.dataTransfer.files;
          if (files && files.length > 0) {
            processFile(files[0]);
          }
        };


        useEffect(() => {
          if (destinationFolderName) {
            const userSubFolder = userName.trim();
            let prefix = destinationFolderName.trim();
            
            if (prefix && !prefix.endsWith('\\')) {
              prefix += '\\';
            }

            if (userSubFolder) {
              prefix += userSubFolder + '\\';
            }
            setDestinationPrefix(prefix);
          } else {
            setDestinationPrefix('');
          }
        }, [destinationFolderName, userName]);

        const handleGenerateScript = () => {
            if (filePaths.length === 0 || !destinationPrefix || !file) return;

            const scriptLines = [
                '@echo off',
                'chcp 65001 > nul',
                'setlocal enabledelayedexpansion',
                '',
                `set "DEST_BASE_PATH=${destinationPrefix}"`,
                `set "FILE_LIST_PATH=%~dp0${file.name}"`,
                '',
                'echo =============================================================',
                'echo           File List Copy Script',
                'echo =============================================================',
                'echo.',
                'echo Destination folder: %DEST_BASE_PATH%',
                'echo Source list file:   %FILE_LIST_PATH%',
                'echo.',
                '',
                'if not exist "%FILE_LIST_PATH%" (',
                `    echo ERROR: File list '%FILE_LIST_PATH%' not found.`,
                `    echo Please make sure this script is in the same folder as '${file.name}'.`,
                '    echo.',
                '    pause',
                '    goto :EOF',
                ')',
                '',
                'echo Starting file copy process...',
                'echo.',
                '',
                `for /f "usebackq delims=" %%S in ("%FILE_LIST_PATH%") do (`,
                '    set "SOURCE_PATH=%%S"',
                '',
                '    REM Skip empty lines',
                '    if defined SOURCE_PATH (',
                '        REM Create destination path by replacing the source drive letter',
                '        set "SANITIZED_PATH=!SOURCE_PATH::=!"',
                '        set "FULL_DEST_PATH=%DEST_BASE_PATH%!SANITIZED_PATH!"',
                '',
                '        REM Get the destination directory from the full file path',
                '        for %%D in ("!FULL_DEST_PATH!") do set "DEST_DIR=%%~dpD"',
                '',
                '        REM Create directory if it does not exist',
                '        if not exist "!DEST_DIR!" (',
                '            echo Creating directory: "!DEST_DIR!"',
                '            mkdir "!DEST_DIR!"',
                '        )',
                '',
                '        REM Copy the file',
                '        echo Copying "!SOURCE_PATH!"',
                '        copy /Y "!SOURCE_PATH!" "!DEST_DIR!" > nul',
                '        if errorlevel 1 (',
                '           echo   ^> FAILED to copy "!SOURCE_PATH!"',
                '        )',
                '    )',
                ')',
                '',
                'echo.',
                'echo =======================================',
                'echo      File copy process completed!',
                'echo =======================================',
                'echo.',
                'echo NOTE: This script will delete itself automatically after you press a key.',
                'pause',
                'endlocal',
                '',
                'REM Self-destruct command',
                '(goto) 2>nul & del "%~f0"'
            ];

            setGeneratedScript(scriptLines.join('\r\n'));
            setStatus('success');
        };

        const handlePaste = async () => {
          try {
            if (!navigator.clipboard?.readText) {
              setError('클립보드 API가 이 브라우저에서 지원되지 않습니다.');
              setStatus('error');
              return;
            }
            const text = await navigator.clipboard.readText();
            setDestinationFolderName(text.trim());
            setError(null);
          } catch (err) {
            console.error('클립보드 읽기 실패:', err);
            setError('클립보드에서 경로를 붙여넣는 데 실패했습니다. 브라우저 권한을 확인해주세요.');
            setStatus('error');
          }
        };

        const handleDownloadAndReset = () => {
          const blob = new Blob([generatedScript], { type: 'text/plain;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'copy_files.bat';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          setTimeout(handleReset, 100);
        };

        const renderContent = () => {
          switch (status) {
            case 'success':
              return (
                React.createElement('div', { className: "w-full max-w-2xl text-left" },
                  React.createElement('div', { className: "flex items-center gap-3 mb-4" },
                    React.createElement(CheckCircleIcon, { className: "w-10 h-10 text-green-400 flex-shrink-0" }),
                    React.createElement('h2', { className: "text-2xl font-bold text-green-400" }, "스크립트 생성 완료!")
                  ),
                  React.createElement('div', { className: "bg-slate-900/80 border-l-4 border-cyan-500 p-4 mb-6" },
                    React.createElement('p', { className: "font-bold text-lg text-slate-200 mb-2" }, "중요 실행 방법:"),
                    React.createElement('ol', { className: "list-decimal list-inside space-y-2 text-slate-300" },
                      React.createElement('li', null, 
                        React.createElement('strong', null, "스크립트 다운로드:"), " 아래 버튼을 클릭하여 ",
                        React.createElement('code', {className: "bg-slate-700 px-1 rounded"}, "copy_files.bat"),
                        " 파일을 다운로드하세요."
                      ),
                      React.createElement('li', null, 
                        React.createElement('strong', null, "파일 이동:"), " 다운로드한 ",
                        React.createElement('code', {className: "bg-slate-700 px-1 rounded"}, "copy_files.bat"),
                        " 파일을 원래 파일 목록인 ",
                        React.createElement('strong', {className: "text-cyan-400"}, file?.name),
                        " 파일과 ",
                        React.createElement('strong', null, "같은 폴더에"),
                        " 넣어주세요."
                      ),
                      React.createElement('li', null, 
                        React.createElement('strong', null, "스크립트 실행:"), " ",
                        React.createElement('code', {className: "bg-slate-700 px-1 rounded"}, "copy_files.bat"),
                        " 파일을 더블클릭하여 실행하면 복사가 시작됩니다."
                      )
                    )
                  ),
                  React.createElement('button', {
                    onClick: handleDownloadAndReset,
                    className: "w-full flex items-center justify-center gap-3 px-6 py-4 mb-4 text-white font-bold text-lg rounded-lg transition-all duration-300 bg-cyan-600 hover:bg-cyan-700"
                  },
                    React.createElement(React.Fragment, null, 
                      React.createElement(ArrowDownTrayIcon, { className: "w-6 h-6" }), 
                      "스크립트 다운로드 및 실행"
                    )
                  )
                )
              );
            case 'error':
              return (
                 React.createElement('div', { className: "text-center" },
                  React.createElement(XCircleIcon, { className: "w-16 h-16 text-red-500 mx-auto mb-4" }),
                  React.createElement('h2', { className: "text-3xl font-bold mb-2 text-red-400" }, "오류"),
                  React.createElement('p', { className: "text-lg text-slate-300 mb-4 bg-red-900/50 p-3 rounded-md" }, error),
                  React.createElement('button', {
                    onClick: handleReset,
                    className: "mt-4 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition-colors"
                  }, "다시 시도")
                )
              );
            case 'idle':
            default:
              const sanitizePathForDestination = (path) => {
                  if (!path) return '';
                  return path.replace(/^([a-zA-Z]):/, '$1');
              };

              const exampleSourcePath = filePaths.length > 0 ? filePaths[0] : 'D:\\data\\file.txt';
              const exampleDestPath = destinationPrefix ? `${destinationPrefix}${sanitizePathForDestination(exampleSourcePath)}` : '';

              return (
                React.createElement(React.Fragment, null,
                  React.createElement('div', { className: "w-full max-w-lg mb-8" },
                      React.createElement('h2', { className: "text-lg font-semibold mb-2 flex items-center gap-2" },
                          React.createElement('span', { className: "flex items-center justify-center w-8 h-8 rounded-full bg-cyan-500 text-slate-900 font-bold text-md" }, "1"),
                          "파일 목록 업로드"
                      ),
                      React.createElement('label', { 
                        htmlFor: "file-upload", 
                        className: `flex flex-col items-center justify-center w-full h-48 border-2 border-slate-600 border-dashed rounded-lg cursor-pointer bg-slate-800 hover:bg-slate-700 transition-all duration-200 ${isDragging ? "bg-slate-700 border-cyan-500 ring-2 ring-cyan-500" : ""}`,
                        onDragEnter: handleDragEnter,
                        onDragLeave: handleDragLeave,
                        onDragOver: handleDragOver,
                        onDrop: handleDrop
                      },
                          React.createElement('div', { className: "flex flex-col items-center justify-center pt-5 pb-6" },
                              React.createElement(UploadIcon, { className: "w-10 h-10 mb-3 text-slate-400" }),
                              file ? (
                                   React.createElement('p', { className: "text-center font-semibold text-cyan-400" }, `${file.name}`, React.createElement('br'), `(${filePaths.length}개의 경로 찾음)`)
                              ) : (
                                  React.createElement(React.Fragment, null,
                                      React.createElement('p', { className: "mb-2 text-sm text-slate-400" }, React.createElement('span', { className: "font-semibold" }, "클릭하여 업로드"), "하거나 파일을 드래그 앤 드롭하세요"),
                                      React.createElement('p', { className: "text-xs text-slate-500" }, "한 줄에 하나의 파일 경로가 있는 .txt 파일")
                                  )
                              )
                          ),
                          React.createElement('input', { id: "file-upload", type: "file", className: "hidden", onChange: handleFileChange, accept: ".txt" })
                      )
                  ),
                  
                  React.createElement('div', { className: "w-full max-w-lg mb-8" },
                    React.createElement('h2', { className: "text-lg font-semibold mb-2 flex items-center gap-2" },
                        React.createElement('span', { className: "flex items-center justify-center w-8 h-8 rounded-full bg-cyan-500 text-slate-900 font-bold text-md" }, "2"),
                        "대상 폴더 지정"
                    ),
                    React.createElement('div', { className: "space-y-4" },
                      React.createElement('div', null,
                        React.createElement('label', { htmlFor: "destination-folder", className: "text-sm text-slate-400 mb-1 block" }, "전체 대상 경로:"),
                        React.createElement('div', { className: "flex items-center gap-2" },
                          React.createElement('input', { 
                              id: "destination-folder",
                              type: "text", 
                              value: destinationFolderName,
                              onChange: (e) => setDestinationFolderName(e.target.value),
                              placeholder: "예: D:\\AAA", 
                              className: "flex-grow w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none font-mono",
                          }),
                          React.createElement('button', {
                            onClick: handlePaste,
                            'aria-label': "클립보드에서 붙여넣기",
                            title: "클립보드에서 붙여넣기",
                            className: "flex-shrink-0 p-3 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-cyan-500"
                          }, 
                            React.createElement(ClipboardIcon, { className: "w-6 h-6 text-slate-300" })
                          )
                        )
                      ),
                      destinationFolderName && (
                        React.createElement('div', { className: "space-y-4 pt-2" },
                           React.createElement('div', null,
                                React.createElement('label', { htmlFor: "user-name", className: "text-sm text-slate-400 mb-1 block" }, "사용자 이름 (선택적 하위 폴더):"),
                                 React.createElement('input', { 
                                    id: "user-name",
                                    type: "text", 
                                    value: userName,
                                    onChange: (e) => setUserName(e.target.value),
                                    placeholder: "하위 폴더를 만들려면 사용자 이름을 입력하세요", 
                                    className: "w-full px-4 py-3 bg-slate-800 border border-slate-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none",
                                    "aria-describedby": "full-path-desc"
                                })
                            ),
                            destinationPrefix && (
                                React.createElement('div', null,
                                    React.createElement('p', { id: "full-path-desc", className: "text-sm text-slate-400 mb-1" }, "최종 대상 경로:"),
                                    React.createElement('p', { className: "w-full pl-4 pr-4 py-2 bg-slate-900/80 border border-slate-700 rounded-lg font-mono text-green-400 truncate" }, destinationPrefix),
                                    React.createElement('div', { className: "text-xs text-slate-400 mt-2 p-2 bg-slate-900/50 rounded-md" },
                                        React.createElement('p', { className: "font-semibold" }, "참고: 원본 경로 전체(드라이브 문자 포함)가 대상 폴더 아래에 복제됩니다."),
                                         React.createElement('p', { className: "mt-1" },
                                          `예: `, React.createElement('span', { className: "font-mono text-cyan-400" }, exampleSourcePath), ` 파일은 다음 위치로 복사됩니다:`,
                                          React.createElement('br'),
                                          React.createElement('span', { className: "font-mono text-cyan-400 break-all" }, exampleDestPath)
                                        )
                                    )
                                )
                            )
                        )
                     )
                    )
                  ),

                  React.createElement('div', { className: "w-full max-w-lg text-center" },
                      React.createElement('button', {
                          onClick: handleGenerateScript,
                          disabled: !file || !destinationPrefix,
                          className: "w-full px-6 py-4 bg-cyan-600 text-white font-bold text-lg rounded-lg hover:bg-cyan-700 disabled:bg-slate-700 disabled:text-slate-500 disabled:cursor-not-allowed transition-colors"
                      }, "파일목록 복사")
                  )
                )
              );
          }
        };

        return (
          React.createElement('div', { className: "min-h-screen flex flex-col items-center justify-center p-4 bg-slate-900" },
            isExpired ? (
              React.createElement('div', { className: "w-full max-w-2xl bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-12 shadow-2xl shadow-slate-950/50 text-center" },
                React.createElement(XCircleIcon, { className: "w-20 h-20 text-red-500 mx-auto mb-6" }),
                React.createElement('h1', { className: "text-4xl font-extrabold text-red-400 mb-4" }, "사용 기한 만료"),
                React.createElement('p', { className: "text-lg text-slate-300" }, "이 애플리케이션의 사용 기한이 경과하였습니다.")
              )
            ) : (
              React.createElement('div', { className: "w-full max-w-3xl bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-8 shadow-2xl shadow-slate-950/50" },
                React.createElement('div', { className: "text-center mb-8" },
                  React.createElement('h1', { className: "text-4xl font-extrabold text-slate-100 tracking-tight" }, "파일목록 복사"),
                  React.createElement('p', { className: "text-slate-400 mt-2" }, "복사 작업을 위한 Windows 배치 스크립트를 생성합니다.")
                ),
                
                React.createElement('div', { className: "flex flex-col items-center" },
                    renderContent()
                )
              )
            )
          )
        );
      };

      // --- Mount the App ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        React.createElement(React.StrictMode, null, React.createElement(App, null))
      );
    </script>
  </body>
</html>
